name: cloudnative-pg-clusters
namespace: cnpg-system

backup:
  b2:
    bucket: "github-otaru-cloudnative-pg-backup"
    endpoint: "https://s3.eu-central-003.backblazeb2.com"

defaults:
  cluster:
    instances: 2
    storage:
      size: "1Gi"
      storageClass: "longhorn-crypto-global"
    plugins:
    - enabled: true
      name: "barman-cloud.cloudnative-pg.io"
      isWALArchiver: true
      parameters:
        barmanObjectName: "b2-backup"
    backup:
      retentionPolicy: "2d"
  scheduledBackup:
    enabled: true
    schedule: "0 2 * * *"
  objectStore:
    retentionPolicy: "2d"
    instanceSidecarConfiguration:
      retentionPolicyIntervalSeconds: 1800

clusters:
  # https://cloudnative-pg.io/documentation/current/recovery/#restoring-into-a-cluster-with-a-backup-section
  # Avoid reusing the same ObjectStore configuration for both backup and recovery in the same cluster. If you must, ensure that each cluster uses a unique serverName
  # to prevent accidental overwrites of backup or WAL archive data.
  # naming convention: $clusterName-$date-$time
  example-db-20250723-0224:
    bootstrap:
      recovery:
        source: backup-source
    externalClusters:
      - name: backup-source
        plugin:
          enabled: true
          isWALArchiver: true
          name: barman-cloud.cloudnative-pg.io
          parameters:
            barmanObjectName: b2-backup
            serverName: example-db
